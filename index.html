<script>
// حط هنا رابط الويب آب الحالي من Google Script
const API = "https://script.google.com/macros/s/AKfycbyThHv9hINEjNZgh98bidZKUiH7KOp514MPIbvRRPtK0P5UTw9js7PK28Isdj5tEnbT/exec";

// التبديل بين تسجيل الدخول والتسجيل
function showRegister() {
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("registerBox").classList.remove("hidden");
}
function showLogin() {
    document.getElementById("registerBox").classList.add("hidden");
    document.getElementById("loginBox").classList.remove("hidden");
}

// -------- تسجيل مستخدم جديد --------
function register() {
    let name     = document.getElementById("reg_name").value;
    let username = document.getElementById("reg_username").value;
    let email    = document.getElementById("reg_email").value;
    let pass     = document.getElementById("reg_pass").value;
    let pass2    = document.getElementById("reg_pass2").value;

    if (pass !== pass2) {
        alert("كلمة المرور غير متطابقة");
        return;
    }

    // نرسل البيانات كـ form data (بدون JSON)
    let formData = new URLSearchParams();
    formData.append("action",   "register");
    formData.append("name",     name);
    formData.append("username", username);
    formData.append("email",    email);
    formData.append("password", pass);

    fetch(API, {
        method: "POST",
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        alert(data.message);
        if (data.status === "success") {
            showLogin();
        }
    })
    .catch(err => {
        alert("خطأ في الاتصال: " + err);
    });
}

// -------- تسجيل الدخول --------
function login() {
    let user = document.getElementById("login_user").value;
    let pass = document.getElementById("login_pass").value;

    let formData = new URLSearchParams();
    formData.append("action",   "login");
    formData.append("user",     user);
    formData.append("password", pass);

    fetch(API, {
        method: "POST",
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        alert(data.message);
        if (data.status === "success") {
            // بعد تسجيل الدخول الناجح
            window.location.href = "home.html";
        }
    })
    .catch(err => {
        alert("خطأ في الاتصال: " + err);
    });
}
</script>